apiVersion: v1
kind: Pod
spec:
  # <leo-ci:affinity>
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: nodetype
            operator: In
            values:
            - builds
  # </leo-ci:affinity>
  containers:
  # <leo-ci:containers>
  - name: node
    image: eu.gcr.io/leo-platform-infra/leo-ci/build/node:12.13-slim
    imagePullPolicy: Always
    securityContext:
      runAsUser: 1000
    env:
    - name: CI
      value: true
    command:
    - cat
    tty: true
    resources:
      requests:
        cpu: 2
        memory: 2Gi
      limits:
        cpu: 4
        memory: 4Gi
  # </leo-ci:containers>
  volumes:
  # <leo-ci:volumes>
  - name: service-account-credentials
    secret:
      secretName: google-application-credentials
      items:
      - key: credentials.json
        path: credentials.json
  - name: dockersock
    hostPath:
      path: /var/run/docker.sock
  # </leo-ci:volumes>
